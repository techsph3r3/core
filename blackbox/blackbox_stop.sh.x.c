#if 0
	shc Version 3.8.9b, Generic Script Compiler
	Copyright (c) 1994-2015 Francisco Rosales <frosal@fi.upm.es>

	shc -v -f blackbox_stop.sh 
#endif

static  char data [] = 
#define      pswd_z	256
#define      pswd	((&data[48]))
	"\202\001\025\147\107\000\275\232\105\273\246\204\115\137\125\331"
	"\251\247\072\236\260\116\155\332\267\076\021\362\100\320\324\302"
	"\322\351\052\032\352\350\264\060\243\133\265\360\272\012\311\143"
	"\214\027\142\336\375\246\303\107\241\374\103\271\230\306\177\067"
	"\340\021\356\177\002\017\151\356\326\256\276\262\312\062\065\127"
	"\112\227\065\107\075\371\216\337\366\322\231\216\231\030\306\172"
	"\052\264\371\054\303\143\032\231\021\331\113\334\013\200\064\125"
	"\030\152\235\126\144\054\065\132\376\316\351\227\347\257\021\021"
	"\143\013\075\047\156\130\301\200\061\015\135\074\216\222\222\246"
	"\375\060\374\142\134\062\274\132\000\246\362\347\125\004\370\271"
	"\017\066\341\176\216\242\377\277\257\135\374\075\357\217\344\355"
	"\277\340\117\033\022\013\165\023\261\150\372\007\154\363\301\174"
	"\051\242\372\270\105\371\170\364\126\164\062\106\003\026\063\302"
	"\367\202\336\011\216\123\035\100\273\027\110\050\013\011\244\065"
	"\254\236\355\361\230\145\346\357\332\030\065\336\057\151\241\046"
	"\354\177\060\172\322\115\272\216\145\003\266\161\015\132\246\271"
	"\371\224\253\221\372\222\201\324\252\267\263\332\040\124\001\015"
	"\323\061\207\245\177\102\064\345\105\352\126\122\105\375\014\076"
	"\221\270\320\214\112\121\141\365\011\024\317\052\150\320\067\073"
	"\261\003\001\142\122\157\074\011\255\116\374\356\037\320\261\362"
	"\272\333\014\244\303\300\325\146\034\212\126\326\224\040\072\106"
	"\044\074\250\166\254\345\200\132\063\174\110\123\114\371\105\007"
	"\325\122\254\230\022\201\376\057\013"
#define      xecc_z	15
#define      xecc	((&data[361]))
	"\374\351\036\327\214\227\230\326\160\341\343\143\321\206\020\166"
	"\100"
#define      tst2_z	19
#define      tst2	((&data[381]))
	"\217\021\051\225\110\156\162\174\215\221\134\027\361\204\216\267"
	"\252\327\224\137\076\373\164\221"
#define      tst1_z	22
#define      tst1	((&data[405]))
	"\314\374\133\112\357\002\227\043\035\175\262\045\332\270\001\357"
	"\144\210\165\002\347\132\132\023\134"
#define      opts_z	1
#define      opts	((&data[427]))
	"\135"
#define      msg2_z	19
#define      msg2	((&data[430]))
	"\063\246\376\001\333\315\276\304\015\166\014\334\243\245\266\362"
	"\057\214\205\236\373"
#define      chk1_z	22
#define      chk1	((&data[450]))
	"\233\117\367\321\041\260\236\157\321\335\206\201\026\255\135\004"
	"\031\230\047\304\077\212\202\210\334\073\376\035"
#define      date_z	1
#define      date	((&data[477]))
	"\322"
#define      rlax_z	1
#define      rlax	((&data[478]))
	"\032"
#define      shll_z	8
#define      shll	((&data[479]))
	"\343\373\024\235\230\264\150\035"
#define      text_z	1014
#define      text	((&data[560]))
	"\312\245\333\014\007\166\240\026\252\107\246\335\035\101\145\371"
	"\175\143\027\237\375\262\121\247\167\167\343\277\106\055\325\021"
	"\322\260\035\332\047\276\361\321\005\227\256\042\330\024\034\125"
	"\170\063\365\165\346\106\034\135\276\000\035\004\055\362\025\000"
	"\243\063\333\312\361\314\234\366\143\145\115\116\230\072\001\021"
	"\342\374\006\150\062\173\272\172\313\147\042\323\232\204\136\074"
	"\176\213\173\361\062\056\224\143\072\323\001\112\333\133\215\256"
	"\005\015\374\235\103\260\057\371\077\012\014\206\330\241\163\172"
	"\350\323\061\032\305\021\344\147\047\062\157\313\132\353\331\233"
	"\121\373\356\047\232\226\103\007\267\217\126\264\353\322\026\345"
	"\163\322\170\310\137\277\267\316\266\324\310\100\040\336\334\334"
	"\122\016\336\204\252\001\171\322\055\156\135\362\005\307\320\165"
	"\132\067\205\324\110\127\165\340\110\217\275\304\063\164\141\335"
	"\012\347\024\306\313\165\106\371\337\176\357\263\313\274\135\053"
	"\006\302\367\112\127\351\172\305\066\247\312\235\046\204\022\024"
	"\353\046\110\172\161\275\320\107\152\347\155\035\237\057\337\336"
	"\153\166\040\301\114\156\004\001\075\301\372\372\073\376\306\122"
	"\244\017\145\332\027\224\153\210\265\262\132\251\154\025\123\146"
	"\375\154\245\115\245\056\357\205\035\005\036\346\060\330\302\165"
	"\241\026\066\233\116\370\175\064\064\203\124\333\377\164\264\251"
	"\350\252\305\374\045\376\136\227\001\333\014\325\076\305\072\127"
	"\274\210\235\126\070\371\101\360\016\101\157\176\011\047\220\246"
	"\052\217\271\074\306\341\253\005\317\132\155\177\042\155\234\032"
	"\351\317\100\277\303\153\247\366\033\110\023\263\216\056\364\267"
	"\307\322\244\235\050\341\177\151\044\113\342\245\047\331\107\222"
	"\315\164\112\024\302\316\337\035\302\230\257\274\137\013\343\046"
	"\001\166\351\365\160\374\213\044\077\360\132\316\017\100\133\006"
	"\346\147\225\062\301\100\222\116\371\003\057\377\373\316\133\120"
	"\111\143\224\332\060\364\136\161\313\137\154\165\301\323\043\163"
	"\166\167\201\000\353\126\341\204\364\163\172\113\210\073\313\352"
	"\257\110\155\255\311\273\224\176\143\141\034\252\112\171\172\317"
	"\253\206\070\144\256\061\221\376\265\031\213\021\032\302\062\311"
	"\011\214\157\225\107\255\301\263\254\001\124\225\126\307\207\101"
	"\164\043\175\141\363\025\376\160\226\340\156\132\311\165\374\034"
	"\376\120\205\200\206\163\073\030\021\077\016\036\154\173\304\372"
	"\375\112\007\253\200\314\172\061\216\260\370\107\014\116\002\256"
	"\133\253\136\167\363\147\234\076\246\335\165\313\005\222\257\023"
	"\005\221\261\351\173\256\347\164\302\101\251\112\366\261\202\177"
	"\301\160\362\213\007\141\324\044\020\367\115\323\257\375\021\133"
	"\241\000\344\261\170\162\246\264\251\352\107\166\175\360\235\017"
	"\224\372\314\011\355\245\373\075\273\071\317\000\174\006\246\036"
	"\237\251\316\375\104\070\276\166\272\073\137\010\142\045\070\264"
	"\316\327\375\044\241\370\022\041\031\052\337\222\024\347\044\223"
	"\124\265\151\331\323\117\136\044\117\124\315\157\222\111\373\007"
	"\060\172\037\071\034\002\271\205\100\234\160\237\236\361\046\033"
	"\027\164\345\304\333\242\201\067\362\231\244\362\100\112\336\236"
	"\313\176\374\225\121\236\101\011\045\354\204\212\044\063\131\214"
	"\125\355\055\350\002\316\223\345\374\233\236\333\121\304\344\227"
	"\115\124\116\174\256\136\054\147\144\153\364\233\045\115\244\047"
	"\343\140\303\166\211\300\077\121\311\100\160\154\345\144\163\332"
	"\326\344\076\073\342\073\260\362\010\175\073\060\365\102\335\230"
	"\013\166\347\146\147\306\215\166\024\251\273\325\247\371\024\371"
	"\035\025\246\052\320\277\371\002\001\363\371\032\367\334\335\347"
	"\014\151\123\041\044\073\316\155\172\265\304\133\263\052\373\351"
	"\061\365\276\327\036\025\024\127\225\276\107\211\053\021\313\106"
	"\130\270\366\310\323\122\165\052\267\033\172\223\102\055\003\236"
	"\032\373\107\174\041\017\256\327\325\340\027\371\331\215\375\046"
	"\165\374\234\227\352\276\154\226\113\072\033\127\000\202\063\041"
	"\172\346\247\076\277\137\352\310\164\326\200\326\263\007\041\147"
	"\320\147\246\247\166\072\265\103\265\261\260\124\231\023\313\267"
	"\016\157\316\062\301\351\264\333\163\202\004\324\071\343\154\313"
	"\022\151\166\315\377\076\010\215\101\006\266\063\252\050\335\060"
	"\370\105\342\356\044\372\371\157\046\137\323\356\070\344\061\323"
	"\132\362\031\331\114\330\104\037\240\047\033\376\341\001\250\324"
	"\243\141\312\274\164\124\014\253\323\261\227\355\352\123\020\042"
	"\141\145\264\033\142\264\103\323\255\304\072\146\322\114\153\243"
	"\330\223\115\156\172\074\133\104\145\152\313\106\356\352\103\302"
	"\333\260\303\315\271\236\203\247\253\241\364\371\057\134\262\113"
	"\031\073\137\066\221\327\152\206\115\120\314\151\256\212\151\313"
	"\217\227\276\244"
#define      chk2_z	19
#define      chk2	((&data[1596]))
	"\163\323\126\351\063\057\177\271\312\242\130\137\252\145\166\234"
	"\045\226\032\131\054\311\077\310"
#define      msg1_z	42
#define      msg1	((&data[1625]))
	"\331\336\163\017\157\113\021\001\043\045\206\245\142\346\236\226"
	"\041\117\203\332\102\332\275\101\063\056\005\270\175\074\321\146"
	"\335\313\213\333\217\000\033\275\013\116\324\341\127\321\273\170"
#define      inlo_z	3
#define      inlo	((&data[1667]))
	"\302\166\170"
#define      lsto_z	1
#define      lsto	((&data[1670]))
	"\065"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	0	/* Define as 1 to enable ptrace the executable */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask  = (unsigned long)&chkenv;
	mask ^= (unsigned long)getpid() * ~mask;
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];

	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	ret = chkenv(argc);
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
	varg[j++] = argv[0];		/* My own name at execution */
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
