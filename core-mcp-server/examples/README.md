# CORE Topology Examples

This directory contains example network topologies generated by the CORE MCP Server.

## Files

### `tailscale_mesh_example.xml`

A properly structured Tailscale mesh network with:
- 5 Docker nodes running Tailscale
- Optional management network for initial access
- Explicit node IDs (prevents "unknown node id None" error)
- Ready for custom Tailscale service

**To use:**

```bash
# Load in CORE GUI
core-gui -f tailscale_mesh_example.xml

# Or via CLI
core-cli -f tailscale_mesh_example.xml
```

**Setup Tailscale:**

After loading the topology, configure Tailscale on each node:

```bash
# Example for node1
docker exec ts-node1 tailscaled --state=/var/lib/tailscale/tailscaled.state &
docker exec ts-node1 tailscale up --authkey=tskey-auth-xxxxx --hostname=ts-node1
```

## Generating More Examples

Use the topology generator to create custom examples:

```python
from core_mcp.topology_generator import TopologyGenerator

gen = TopologyGenerator()

# Example 1: Star topology
gen.generate_from_description("Create a star with 6 hosts")
with open("star_topology.xml", "w") as f:
    f.write(gen.to_xml())

# Example 2: Wireless mesh
gen.clear()
gen.generate_from_description("Build a wireless mesh with 8 MDR nodes")
with open("wireless_mesh.py", "w") as f:
    f.write(gen.to_python_script())

# Example 3: Enterprise network
gen.clear()
gen.generate_from_description("Create a ring of 10 routers running OSPF")
with open("enterprise_ring.xml", "w") as f:
    f.write(gen.to_xml())
```

## Common Patterns

### Star Topology
```
        ┌────┐
    ┌───┤ SW ├───┐
    │   └────┘   │
  ┌─┴─┐        ┌─┴─┐
  │ H1│        │ H2│
  └───┘        └───┘
```

Use: "Create a star topology with a switch and 4 hosts"

### Line/Chain Topology
```
  ┌───┐    ┌───┐    ┌───┐
  │R1 ├────┤R2 ├────┤R3 │
  └───┘    └───┘    └───┘
```

Use: "Build a chain of 3 routers"

### Ring Topology
```
    ┌───┐
  ┌─┤R1 ├─┐
  │ └───┘ │
┌─┴─┐   ┌─┴─┐
│R4 │   │R2 │
└─┬─┘   └─┬─┘
  │ ┌───┐ │
  └─┤R3 ├─┘
    └───┘
```

Use: "Create a ring of 4 routers"

### Wireless Mesh
```
     (W)
    / | \
   /  |  \
 [M1][M2][M3]

W = WLAN node
M = MDR node
```

Use: "Make a wireless mesh with 3 MDR nodes"

### Tailscale Mesh
```
  [D1]────Tailscale────[D2]
    │                    │
    │                    │
  [D3]─────Tailscale────[D4]

D = Docker node with Tailscale
```

Use: "Create a tailscale mesh with 4 docker nodes"

## Best Practices

1. **Always Use Explicit Node IDs**: Prevents "unknown node id None" error
2. **Create Nodes Before Links**: Ensure nodes exist before referencing them in links
3. **Assign Services After Node Creation**: Services should be configured after the node is created
4. **Use Descriptive Names**: Makes debugging easier (e.g., "core-router" not "n1")
5. **Set Realistic Link Parameters**: Use appropriate bandwidth, delay, loss values

## Troubleshooting

### "Unknown node id None"

This error occurs when node IDs are not properly assigned. All examples in this directory use explicit node IDs.

**BAD:**
```xml
<device name="router1" type="router">
  <!-- No ID specified! -->
```

**GOOD:**
```xml
<device id="1" name="router1" type="router">
  <!-- Explicit ID -->
```

### Service Not Found

If CORE can't find a service (like "Tailscale"), you need to create a custom service first. See DEPLOYMENT.md for details.

### Docker Nodes Not Starting

Ensure the Docker daemon is running inside CORE:

```bash
# In the CORE container
service docker status
service docker start
```

## Contributing Examples

To add a new example:

1. Generate the topology using the MCP server
2. Test it in CORE to verify it loads correctly
3. Add documentation explaining the topology purpose
4. Include any special setup instructions
5. Submit a PR

## Resources

- [CORE Documentation](https://coreemu.github.io/core/)
- [CORE XML Schema](https://github.com/coreemu/core/blob/master/daemon/core/gui/data/core.xsd)
- [CORE gRPC Examples](https://github.com/coreemu/core/tree/master/package/share/examples/grpc)
- [Tailscale Documentation](https://tailscale.com/kb/)
